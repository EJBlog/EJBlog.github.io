<!DOCTYPE html>
<html class="no-js">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Editor</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">

	<link rel="stylesheet" href="css/editor.css">
	<link rel="stylesheet" href="css/ui-lightness-jquery-ui-1.8.7.custom.css">

</head>
<style>
	.clip-svg {
		clip-path: url(#myClip);
	}
</style>

<body>

	<img class="clip-svg" src="img/ota_badge.jpg">

	<svg width="0" height="0">
		<defs>
			<clipPath id="myClip">
				<!-- <path stroke="#000000" d= statePath />   No Bueno -->
				<!-- <path stroke="#000000" d= String(statePathObj) /> No Bueno -->
				<!-- <path stroke="#000000" d="M,361.1,70.77,l,-5.3,57.13,l,-1.3,15.2,l,-59.1,-6.6,l,-49,-7.1,l,-1.4,11.2,l,-1.9,-1.7,l,-0.4,-2.5,l,-1.3,-1.9,l,-3.3,1.5,l,-0.7,2.5,l,-2.3,0.3,l,-3.8,-1.6,l,-4.1,0.1,l,-2.4,0.7,l,-3.2,-1.5,l,-3,0.2,l,-2.1,1.9,l,-0.9,-0.6,l,-0.7,-3.4,l,0.7,-3.2,l,-2.7,-3.2,l,-3.3,-2.5,l,-2.5,-12.6,l,-0.1,-5.3,l,-1.6,-0.8,l,-0.6,1,l,-4.5,3.2,l,-1.2,-0.1,l,-2.3,-2.8,l,-0.2,-2.8,l,7,-17.15,l,-0.6,-2.67,l,-3.5,-1.12,l,-0.4,-0.91,l,-2.7,-3.5,l,-4.6,-10.41,l,-3.2,-1.58,l,-1.8,-4.26,l,1.3,-4.63,l,-3.2,-7.57,l,4.4,-21.29,l,32.7,6.89,l,18.4,3.4,l,32.3,5.3,l,29.3,4,l,29.2,3.5,l,30.8,3.07z" /> -->
				<path stroke="#000000" d="M2 60c8,-41 48,-67 88,-59 41,8 67,48 59,88 -8,41 -48,67 -88,59 -14,-3 -26,-9 -35,-18 3,-4 6,-9 7,-14 4,-18 -8,-35 -25,-38 -2,0 -4,-1 -6,-1 0,-6 0,-12 1,-17z" />
     <!-- <circle stroke="#000000" stroke-miterlimit="10" cx="193.949" cy="235" r="74.576"/> -->
		<!-- <path> <script> canvas.add(statePathObj);</script> </path> -->
			</clipPath>
		</defs>
	</svg>

	<p id="statePath"></p>

	<div id="imageEditor">
		<section id="editorContainer">
			<canvas id="editor" width="480" height="480" style="border:1px solid #000000"></canvas>
		</section>
	</div>

	<input type="file" id="UploadImage" href="#" title="Upload Your Image">Upload Image</input>
	<button type="button" onclick="testPath()">Test Path</button>

	<script src="jquery/jquery-1.12.4.min.js"></script>
	<script src="jquery/jquery-ui-1.10.3.js"></script>
	<script src="js/raphael.js"></script>
	<script src="js/usa_map.js"></script>
	<script src="js/Fabric_JS/fabric.min.js"></script>


	<script>
		//Changing the control colors from light blue to black
		fabric.Object.prototype.set({
			transparentCorners: true,
			borderColor: '#111111',
			cornerColor: '#111111'
		});

		//get information about the state that the user clicked on the main map page
		var stateNameStored = localStorage.getItem('storedStateName');
		var idNameStored = localStorage.getItem('storedIdName');

		// changing the editor background color
		var canvas = new fabric.Canvas('editor', {
			backgroundColor: 'white'
		});

		// const flyArrowPath = 'M,361.1,70.77,l,-5.3,57.13,l,-1.3,15.2,l,-59.1,-6.6,l,-49,-7.1,l,-1.4,11.2,l,-1.9,-1.7,l,-0.4,-2.5,l,-1.3,-1.9,l,-3.3,1.5,l,-0.7,2.5,l,-2.3,0.3,l,-3.8,-1.6,l,-4.1,0.1,l,-2.4,0.7,l,-3.2,-1.5,l,-3,0.2,l,-2.1,1.9,l,-0.9,-0.6,l,-0.7,-3.4,l,0.7,-3.2,l,-2.7,-3.2,l,-3.3,-2.5,l,-2.5,-12.6,l,-0.1,-5.3,l,-1.6,-0.8,l,-0.6,1,l,-4.5,3.2,l,-1.2,-0.1,l,-2.3,-2.8,l,-0.2,-2.8,l,7,-17.15,l,-0.6,-2.67,l,-3.5,-1.12,l,-0.4,-0.91,l,-2.7,-3.5,l,-4.6,-10.41,l,-3.2,-1.58,l,-1.8,-4.26,l,1.3,-4.63,l,-3.2,-7.57,l,4.4,-21.29,l,32.7,6.89,l,18.4,3.4,l,32.3,5.3,l,29.3,4,l,29.2,3.5,l,30.8,3.07,z';

		const flyArrowPath = 'M1002.51,544.359a1.2,1.2,0,0,0-.02-0.306,1.378,1.378,0,0,0-.16-0.391,2.752,2.752,0,0,1-.34.2c-0.59-.5-0.29-0.822-1.63-0.948l-4.61.2-1.093-.164,2.856,0a18.716,18.716,0,0,0-3.8.068,3.21,3.21,0,0,0-.56-0.111l-0.382-.041-0.1-.029-0.039.014a0.575,0.575,0,0,1-.075-0.048l-0.043-.032c-0.013-.009-0.074-0.094-0.108-0.137l-0.491-.637-0.981-1.273c-0.107-.414,1.019,1.133-0.119-0.809-0.961-1.249.556,1.432-.911-0.716a10.766,10.766,0,0,0-1.515-2.679c-0.071-.275.191,0.04,0.627,0.662-1-1.389-2.442-3.8-3.061-4.448-0.152-.312-0.369-0.7-0.617-1.111-0.126-.206-0.257-0.421-0.389-0.639l-0.611-.976c-0.561-.023-0.11-0.046-0.6-0.065L982.7,529.9l-0.668,1.013a4.554,4.554,0,0,0,1.339,1.557c0.243,0.484,1.2,2.771,1.715,4.254-1.276-2.594,1.863,5.574,1.238,4.987,0.121,0.224-.73.56-0.608,0.831a1.045,1.045,0,0,1,.146.231,0.1,0.1,0,0,1,.025.071c-0.021.008-.043,0.017-0.067,0.024l-0.164.019-0.092.007-0.317.011-0.776.023c-2.1.068-4.411,0.037-6.274,0.144a5.712,5.712,0,0,1,.947-0.066c-2.1-.026-2.711-0.128-4.061-0.191-0.267.282-3.537,0.351-5.3,0.526-2.576-.269,1.56-0.332.75-0.593,0.131,0.229-4.47.233-3.593,0.423a13.23,13.23,0,0,1-2.713-.313c-0.342.353-1.832,0.062-3.463,0.281-2.85-.171-0.736-0.33-3.864-0.219-1.49-.106,1.292-0.235,1.292-0.235-3.187,0-1.494.262-2.169,0.416-3.8.079-10.1-.194-11.393-0.328-2.374.073-4.193,0.319-5.964,0.31-0.133-.043-0.477-0.059-0.074-0.114-2.509.214-39.716,0.019-42.639,0.287a1.873,1.873,0,0,1-.382-0.065c0.475,0.132.548,0.268,0.452,0.364a18.079,18.079,0,0,1-3.188,0,5.811,5.811,0,0,0,1.357-.121l-1.5.077c-1.35-.248,2.042-0.089,2.041-0.273-2.918.084-6.318,0.3-8.555,0.227-0.47-.244,5.229-0.089,2.243-0.3l3.461,0.089c-2.647-.383,2.1.025-0.33-0.385-4.554-.066-5.093.13-9.636,0.064-1.021.137,0.34,0.2-.682,0.338-6.455.251-5.087-.609-9.832-0.278a17.182,17.182,0,0,1-5.082.314l1.15-.278c-4.409-.022-2.514.4-7.133,0.22,0.82-.11,3.464,1.905,2.8,1.873-2.993-.215-2.115-1.842-4.414-1.839l-0.478-.244-15.062.276c0.287-.073,1.177-0.15-0.04-0.224-6.555.13-14-.014-20.322-0.152l-2.415.214c-0.562,0-1.043-.094-0.435-0.136-2.465-.077-0.127.134-1.311,0.219-1.4.016-1.853-.12-0.965-0.184-4.349.184-12.388,0.4-16.972,0.179l0.893-.064c-3.569-.082-13.286.437-16.6,0.244l0.634-.038c-7.745-.083-16.3.12-22.215-0.192-1.122.306-7.666-.127-8.162,0.3-4.424-.2-3.157-0.282-9.387-0.417-1.663-.017-12.479.268-14.536,0.314l-0.051-.221-2.791.236,17.776-.264-1.928.059a4.386,4.386,0,0,1,1.517.162c-1.507.052-13.345,0.015-14.814-.049a17.419,17.419,0,0,1-2.609-.211l-7.127.2a8.564,8.564,0,0,1,1.53-.138c-2.59.12-.2-0.258-3.413-0.063,0.467,0.05-.252.132-0.331,0.177-1.739-.132-5.695-0.129-8.623-0.069l0.562-.153c-5.288-.033-11.147.086-17.081,0.09,2.129,0.068,1.64.334-.1,0.361l-0.7-.233c-1.123.146,1.818,0.086-.488,0.266-2.217-.024-1.492-0.265-0.219-0.342l-2.695.084a1.713,1.713,0,0,1,.638-0.2c-1.105.147-4.652-.23-6.247,0.025l-0.152-.07c-5.932,0-8.622.089-13.455,0.106-0.094.2-1.983,0.159-3.423,0.325-3.551-.061-13.493-0.215-17.772-0.194-3.006.105-.878,0.173-2.229,0.294-0.222-.184-4.5-0.161-2.279-0.3l-5.552.048-2.682.042c-0.9.02-2.526,0.042-3.773,0.07-0.023-.016-0.07-0.056-0.146-0.125l-0.6-.595,0.331,0.413c0.1,0.121.229,0.278,0.237,0.3,0.063,0.1.094,0.168,0,.113l-0.09-.088-0.157-.161-0.317-.336c-0.207-.225-0.4-0.446-0.566-0.639a1.26,1.26,0,0,1-.433-0.631l0.23,0.211q-0.757-.727-1.536-1.515l-0.186-.189L629.439,540c-0.029-.03-0.151.061-0.18,0.031-0.092-.094-0.092-0.31-0.184-0.4l-0.07-.072c-0.1-.107-0.207-0.213-0.31-0.321-0.208-.216-0.486-1.016-0.7-1.236-0.152-.163-1.332.361-1.478,0.207-0.018-.019.064-0.137,0.046-0.155-0.1-.1.8-0.2,0.707-0.3-0.187-.193-0.371-0.38-0.554-0.566l-0.327-.332-0.661-.669c-0.147-.15-0.3-0.3-0.447-0.459-0.041-.041-0.081-0.083-0.122-0.125-0.083-.086-0.3-0.1-0.382-0.191-0.1-.109-0.078-0.29-0.185-0.4-0.043-.046-0.087.507-0.131,0.46-0.091.091,0.416-.422,0.333-0.34l-0.237.23c-0.142.138-.276,0.266-0.408,0.392l-0.317.3c-0.032.03,0.048,0.211,0.016,0.241-0.016.015-.143-0.119-0.16-0.1-0.1.092-.193,0.186-0.3,0.287s-0.235.23-.364,0.36c0.068,0.073.2,0.067,0.272,0.141,0.017,0.018-.034.116-0.017,0.134,0.034,0.038.069,0.075,0.1,0.112l0.431,0.466,0.229,0.248,0.16,0.173c0.062,0.068.125,0.135,0.187,0.2l0.033,0.036,0.063,0.068,0.585,0.633,0.2,0.214,0.317,0.342,0.475,0.514q0.2,0.221.4,0.438c0.013,0.015.026,0.029,0.04,0.043,0.053,0.058.7,0.116,0.754,0.173,0.185,0.2-.226.4-0.044,0.6a0.973,0.973,0,0,1,.328.345,0.789,0.789,0,0,0,.259.107c0.018,0.019-.018.147,0,0.166l0.281,0.3,0.591,0.622a4.692,4.692,0,0,0,.384.335c-0.044.015-.68,0.03-0.721,0.044l-0.363.051c-0.05,0-.041.008-0.144,0.012l-0.376.014-0.753.027-3.009.108c-2.77-.025,1.661-0.143-0.389-0.252l-2.533.108-0.093-.084L620.42,543l-0.576-.581-0.464-.477-0.629-.646c-0.015-.016-0.2-0.044-0.217-0.06-0.052-.055.066-0.1,0.014-0.153l-0.836-.877-0.481-.5a0.474,0.474,0,0,0-.154-0.1c-0.073-.034-0.13-0.254-0.2-0.288-0.053-.025-0.124.739-0.161,0.7s0.047-.805.006-0.848l-0.739-.774c-0.018-.019-0.037-0.038-0.055-0.058l-0.351-.368-0.445-.465-0.042-.044-0.346-.363c-0.077-.078-0.167-0.062-0.245-0.141-0.038-.038-0.064-0.172-0.1-0.21l-0.339-.343-0.5-.51-0.351-.355-0.37-.374-0.422-.427-0.109-.11c-0.074-.076-0.149-0.151-0.224-0.227l-0.164.175-0.343.366-0.132.141c-0.018.019-.016,0.079-0.034,0.1-0.037.04-.094,0.039-0.131,0.078-0.088.1,0.417,0.19,0.328,0.285l-0.181.147-0.03.379-0.113-.26-0.276.275c-0.239.227,0.1,0.475-.2,0.753l0.13,0.144c0.09,0.1.181,0.2,0.275,0.305l0.442,0.491a0.265,0.265,0,0,0,.138.041c0.026,0,.054.046,0.08,0.05a0.331,0.331,0,0,1,.116,0,0.342,0.342,0,0,1,.058.226l0,0.037a0.241,0.241,0,0,0,.055.146l0.668,0.742c0.16,0.175,1.326.355,1.5,0.538,0.063,0.068-1.327.383-1.263,0.451,0.151,0.162.758,0.078,0.916,0.244q0.271,0.288.554,0.583l0.439,0.451,0.534,0.55,0.945,0.973,0.121,0.122,0.038,0.036,0.082,0.075,0.183,0.17c-0.133.007-.861,0.014-0.992,0.02l-0.679,0-0.482,0-1.027,0c-0.539,0-1.136-.007-1.735-0.015l-0.434-.007c-0.975-.016-1.922-0.042-2.6-0.083l0.323,0.127a15.416,15.416,0,0,1-2.811-.1c0.151,0.1,1.567.111,0.67,0.183l-2.862.035-1.248.007c-0.087,0-.141.042-0.228,0.043-0.307,0-.647-0.038-0.955-0.037h-0.1l-0.706,0-0.482,0a2.279,2.279,0,0,0,.083.542l0.027,0.108c0.012,0.043-.03-0.474-0.019-0.431s0.073,0.04.083,0.078l0.021,0.091a1.207,1.207,0,0,1-.048.339c0,0.043-.076.129-0.076,0.171,0,0.1.524,0.2,0.524,0.3,0,0.08-.475.215-0.475,0.294,0,0.062-.12.069-0.12,0.131,0,0.177.071-.218,0.071-0.04,0,0.106.929,0.186,0.929,0.293v0.419l0.343,0c0.111,0,.225-0.073.336-0.072s0.246,0.075.37,0.076l0.455,0c0.409,0-.181,0,0.229.007,0.239,0,.47-0.072.708-0.071,0.478,0,.964.081,1.442,0.083l2.135,0.024c0.654,0.007.868,0.252,1.524,0.259,0.211,0,.878-0.232,1.113-0.229l2.6,0.031c0.515,0.006,1.008.012,1.442,0.019l1.033,0.016,0.258,0,0.114,0,0.024,0,0.092,0.007,0.3,0.03,0.3,0.257-1.591,1.594,0.285,0.311-0.1.512-1.1.7-0.04-.348-0.429.225-0.357.358-0.268.273-0.08.081c-0.109.111,0.782,0.222,0.673,0.333-0.128.129-1.148,0.3-1.276,0.432-0.018.019-.144-0.006-0.162,0.013l-0.5.5-0.472.48c-0.138.14,0.724,0.28,0.587,0.42,0.09,0.094-.826.185-0.747,0.274,0.117,0.133.223,0.26,0.322,0.383s0.293,0.258.389,0.388,0.115,0.285.216,0.423c0.088,0.122.179,0.244,0.275,0.369,0.191,0.247.405-.1,0.677,0.189,0.262-.268-0.13.1,0.053-0.114,0.121-.144.117-0.31,0.233-0.451s0.357-.258.493-0.412c0.122-.137.257-0.282,0.412-0.441,0.264-.269.5-0.51,0.707-0.727l0.214-.223c0.262-.275.483-0.51,0.675-0.718l0.142-.154c0.363-.395.623-0.69,0.9-0.993,0.342-.375.708-0.762,1.324-1.365q0.145-.144.312-0.3c0.482-.466,1.1-1.05,1.925-1.82l-0.977,1.351,0.957-1.045,0.482-.522,0.121-.13,0.03-.033,0-.006,0.008-.011,0.036-.047,0.05-.006,0.027,0,0.147,0,0.633-.009,1.268-.014,2.545-.015h3.561l-0.6.623-0.2.2-0.507.526c-0.016.017,0.009,0.15-.007,0.167s-0.078-.078-0.1-0.059l-0.72.747c-0.142.147,0.715,0.295,0.573,0.443a1.869,1.869,0,0,1-.867.9c-0.779.036-.808,0.322-0.587,0.608a9.748,9.748,0,0,1-1.19.312c-0.029.03-.135,0.026-0.164,0.056l-1.258,1.3-0.347.36c0.1,0.105.2,0.2,0.295,0.293,0.153,0.149-.3.281-0.16,0.4,0.117,0.106.231,0.206,0.344,0.306l0.117,0.1c0.085,0.075.225,0.106,0.313,0.185,0.043,0.039.032,0.123,0.076,0.163,0.181,0.167.373,0.351,0.588,0.571a7.259,7.259,0,0,1,.962-0.823,4.873,4.873,0,0,0,.564-0.514l1.137-1.23a8,8,0,0,1-.917,1.127c0.474-.41,1.162-1.092,1.873-1.831,0.3-.314.609-0.639,0.9-0.957,0.155-.167.308-0.332,0.455-0.494,0.272-.3.527-0.581,0.751-0.835,0.1-.114-0.009-0.3.078-0.4a7.249,7.249,0,0,1,.809-0.708c1-1.008.319-.147,0.977-0.725,0.242-.222.659-0.647,0.706-0.7l0.034-.007,0.021,0,0.163-.006c0.218-.008,1.031-0.016,1.248-0.024l1.256-.05a11.122,11.122,0,0,1,1.865.032,0.634,0.634,0,0,1-.417.049c1.646-.044,5.235.026,4.158-0.154,3.4,0.1,6.506-.083,9.219.038,1.769-.222,11.822.112,12.384-0.2-0.244.325,5.962,0.268,8.114,0.116-0.72.1,1.869,0.1,1.026,0.239,2.454,0,4.7-.06,4.276-0.228,4.52,0.394,9.088-.305,11.633.2,7.29-.168,14.037-0.28,20.6-0.351-0.237.325-7.249,0.026-6.969,0.367,6.222-.128,9.811-0.4,15.98-0.319,1.6,0.045-.907.14-1.447,0.2,6.214-.128,12.014.04,17.543-0.132-0.992-.2-5.233-0.4-4.618-0.513-1.6.4,5.485,0.1,2.582,0.628a3.113,3.113,0,0,0,1.454-.195c1.064,0.03,1.4.088,0.322,0.2,3.9-.077,12.519-0.235,16.056-0.228a8.529,8.529,0,0,1-1.093.182,59.029,59.029,0,0,1,6.58-.212c-0.157.037,0.085,0.084-.439,0.095,4.982-.029,8.572-0.358,14.1-0.221-1.662.308,1.915,0.1,2.213,0.372l3.028-2.078-1.214,1.869c2.652,0.007,5-.186,7.278-0.1l-1.972.109,4.971-.047-2.813-.1c2.684-.136-0.287-0.34,3.244-0.262-0.717.027,2.654,0.006,4.036,0.165h-0.009c1.312-.085,11.925-0.174,13.886-0.105,0.509,0.086-.411.3-0.08,0.354,1.295-.223,6.213-0.056,7.853-0.294-0.546.056-.576,0.2-0.4,0.225l1.087-.181c1.229,0.059,1.409.088,1.209,0.2,3.7,0.037-1.173-.342,3.213-0.191-0.344.014-.18,0.042-0.9,0.069,4.406,0.081,8.513-.108,12.561-0.015,1.194,0.272-3.537.063-2.171,0.293,5.838-.044,12.089-0.313,17.738-0.245l-1.053-.03c0.785-.381,4.206.192,7.064,0.015-0.7.027-.918,0.211-0.729,0.168,3.869,0.065,7.91-.086,13.773-0.2l-0.727.1c2.279,0.09,6,.056,8.466.1,0.731-.1,2.14-0.08,1.285-0.223,7.59,0.565,14.486-.286,21.221.185-0.806,0-1.921.084-1.28,0.085l5.739-1.086a9.609,9.609,0,0,0-1.956-.232c0.727-.1,2.347.828,3.769,0.829-2.581.108,0.021,0.267,1.135,0.361-0.187-.051.2-0.107,0.1-0.159,3,0.3,32.767-.334,36.859-0.131l-0.217.087c1.532-.043,2.944-0.157,4.6-0.131,0.684,0.193-1.631.088-1.737,0.247,2.32-.009,4.58-0.361,6.679-0.167-0.986.053-2.4,0.052-3.389,0.105a37.317,37.317,0,0,0,4.25.208l-0.167-.006,12.263,0.106-1-.062c2.906-.5,5.912-0.086,9.826-0.411-3.8.307-.63,0.179-0.922,0.4a8.352,8.352,0,0,1,2.083.191c1.849-.174,3.085.142,5.7-0.113,0.117,0.07,1.978.009,1.56,0.184,2.4-.053-0.568-0.122-0.365-0.21,1.752-.112,3.792-0.051,6.021.01l3.471,0.073,1.816,0.015,0.357,0,0.25-.009,0.55-.028c-0.037.149-.074,0.3-0.112,0.454l-0.753,2.471c-0.22.77-.407,1.421-0.59,2.062s-0.363,1.272-.572,2c-0.142.482-.311,1.033-0.5,1.625l-0.43,1.213c-0.175.353-.174,0.2-0.083-0.176,0.106-.446.331-1.187,0.331-1.187-0.265.687-.512,1.331-0.751,1.951a5.641,5.641,0,0,0-.245.78c-0.057.221-.113,0.44-0.169,0.659l-0.157.642-0.079.32-0.02.08c-0.006.027-.025,0.062,0.026,0.05l0.2-.006,0.829-.029a1.578,1.578,0,0,0,.406-0.039l0.214-.292c-0.126.191-.133,0.214-0.072,0.165l0.357-.307a7.922,7.922,0,0,0,.6-0.764,2.543,2.543,0,0,0,.208-0.361l0.188-.365a16.662,16.662,0,0,1,1.278-2.063,18.613,18.613,0,0,1-1.117,2.274l1.185-1.968,0.787-1.366c0.52-.906,1.046-1.821,1.6-2.747,0.409-.415-0.545,1.2-0.887,1.882,1.256-2.073,3.281-5.353,3.522-6.089l-0.672.958c0.194-.225.094,0.143-0.159,0.591a8.3,8.3,0,0,1-1.787,2.549l0.737-1.234a1.483,1.483,0,0,0,.375-0.5c0.347-.7.6-0.773,0.718-1.089,0.026-.069.064-0.177,0.106-0.3l0.01-.015-0.01.013c0.085-.246.187-0.551,0.262-0.778l0.193-.3,0.391-.027,0.091-.449a0.7,0.7,0,0,1-.091-0.054l-0.043-.015,0.216-.339-0.082.408a0.251,0.251,0,0,0,.344-0.054l0.149-.222s-0.189,0,.128-0.045a0.5,0.5,0,0,0,.317-0.308h0.631c0.379,0.02.906,0.04,0.906,0.04s0.108,0.009.234,0.014c-0.657.055-1.337,0.128-1.771,0.212-0.415.092-.379,0.2-0.138,0.308a0.886,0.886,0,0,1,.2-0.039l0.229-.033,0.406-.049,0.7-.064a16.072,16.072,0,0,0,1.659-.216,2.519,2.519,0,0,0,1.895-.834c0.212-.03.678,0.984,1.173,0.987,0.248,0,.5,0,0.735-0.014a2.481,2.481,0,0,0,.628-0.138c-0.2.018-.418,0-0.632,0.008l-0.642-.043c-0.437-.025-0.9-1.039-1.37-1.043-0.948-.007-1.958,1.027-2.991,1.1-0.391-.047-0.1-0.1.039-0.142a1.04,1.04,0,0,0,.221-0.016,6.015,6.015,0,0,0,.661-0.037l4.046,0.007c2.668-.142,2.4-0.961,2.4-0.961a0.926,0.926,0,0,0-.11-0.283,0.353,0.353,0,0,1,.1.045c0.06,0.052.12,0.119,0.18,0.182a0.36,0.36,0,0,0,.16.114c-0.02.271-.1,0.1-0.49,0.473a2.383,2.383,0,0,1-.76.713,2.4,2.4,0,0,0,.98-0.638C1002.4,544.718,1002.6,544.907,1002.51,544.359Zm-163.524-.829a14.518,14.518,0,0,0-2.066-.144l2.713,0C839.852,543.461,839.616,543.533,838.986,543.53Zm4.188-.154v0l1.536-.013Zm38.883,1.942c-0.074-.048-0.144-0.113-0.078-0.172l2.095,0A8.562,8.562,0,0,1,882.057,545.318ZM985.572,545.4l-0.851-.181,2.428,0.03-0.018.051c0-.013,0-0.021,0-0.038C986.885,545.306,986.368,545.352,985.572,545.4Zm-1.533,12.783-0.217.329c-0.021.075-.114,0.048-0.178,0.062l-0.211.018a0.853,0.853,0,0,1-.568-0.152,0.1,0.1,0,0,1,.045-0.036l0.932-.009,1.136-1.783c-0.16.289-.324,0.58-0.49,0.852Zm3.491-5.432-1.374,2.363c-0.277.462-.551,0.917-0.815,1.358-0.134.212-.278,0.466-0.4,0.631s-0.234.306-.347,0.452q0.211-.386.406-0.806l0.225-.526,4.19-6.575a0.634,0.634,0,0,0,.248-0.1A21.019,21.019,0,0,0,987.53,552.752Zm-2.585,4.961a0.744,0.744,0,0,1-.083.1l-0.162.169a1.087,1.087,0,0,1-.052.116l0.194-.205a1,1,0,0,0,.093-0.11c0.038-.063.074-0.125,0.11-0.186,0.14-.244.271-0.472,0.4-0.69-0.133.218-.264,0.433-0.4,0.647Zm-1.61-25.232c0.02,0.014.019-.016,0.033-0.014C983.3,532.337,983.275,532.3,983.335,532.481Zm0.631,26.225-0.241.213a5.975,5.975,0,0,0,.518-0.474l-0.157.153Zm-89.377-15.7a6.41,6.41,0,0,1,.973.181C895.237,543.042,898.329,542.987,894.589,543.005Zm90.084,14.869a2.332,2.332,0,0,1-.43.571l0.457-.466C984.747,557.879,984.762,557.81,984.673,557.874ZM671.464,545.981l-3.344-.033C669.055,545.969,670.27,545.98,671.464,545.981Zm72.895-2.8a6.478,6.478,0,0,0-.768.025Zm-92.163,2.79c-0.6-.072-1.229-0.114-1.883-0.141a3.607,3.607,0,0,0-.388.051Zm70.66-2.83c0.219-.01.469-0.024,0.765-0.042C723.375,543.112,723.113,543.126,722.856,543.139Zm10.6,2.57h0S733.453,545.71,733.453,545.709Zm11.238-.01-1.063.039c-0.073-.01-10.13-0.019-10.177-0.028a9.1,9.1,0,0,1-1.174.086C733.368,545.787,744.814,545.846,744.691,545.7Zm-107.755.245c-0.185,0-.347.011-0.474,0.02C636.592,545.959,636.771,545.952,636.936,545.944Zm94.357-2.847,0.009,0.051,0.546-.046Zm166.568,2.457c0.066,0.018,32.458.036,32.715,0.052C930.556,545.593,898.1,545.574,897.861,545.554ZM945,545.613l10.439,0.074C954.533,545.645,945.534,545.625,945,545.613Zm19.775,0.11a0.627,0.627,0,0,0,.225-0.086l-0.023,0Zm-232.5.073-0.441.009C730.8,545.843,731.5,545.828,732.277,545.8Zm54.874-.423c-0.575.036-1.141,0.071-1.741,0.094A4.75,4.75,0,0,0,787.151,545.373Zm-115.32.612a0.021,0.021,0,0,0,.006,0h-0.373Zm111.062-.524c0.963,0.041,1.769.033,2.517,0.006C784.62,545.453,783.689,545.431,782.893,545.461Zm208.271,2.629c-0.017,0-.008-0.033.008-0.073l-0.314.536Zm0.319-.606a4,4,0,0,0-.311.533Zm0.654-1.12-0.654,1.12A8.815,8.815,0,0,0,992.137,546.364Zm-9.871,11.142c0.013,0.05.039,0.062,0.084,0.024A0.842,0.842,0,0,0,982.266,557.506Zm-0.007-.235a1.055,1.055,0,0,1,.024-0.188c0.045-.124.093-0.255,0.144-0.392,0.209-.546.457-1.189,0.71-1.848,0.222-.577.449-1.167,0.654-1.7a8.533,8.533,0,0,0,.32-0.989c-0.238.607-.537,1.37-0.86,2.192-0.211.559-.429,1.139-0.649,1.723l-0.318.881-0.076.217c-0.007.044,0,.074-0.008,0.111l-0.009.208,0.075,0.017A0.864,0.864,0,0,1,982.259,557.271ZM821.467,545.7l0.741-.168-2.294.052Z';


	const arrowPlane = new fabric.Path(flyArrowPath);


		// loading the background/overlay image from SVG of the state that was cicked
		var statePath;
		var statePathObj;
		var groupStates = [];
		var overlayState;
		fabric.loadSVGFromURL("svg/usa_map.svg", function(objects, options) {
				var stateObjects = new fabric.Group(groupStates);
				stateObjects.set({
					left: 10,
					top: 10,
					width: canvas.width - 10,
					height: canvas.height - 10
				});


				for (var i = 0; i < objects.length; i++) {
					if (stateObjects._objects[i].id == idNameStored) {
						overlayState = stateObjects._objects[i];

						overlayState.set({
							opacity: .4,
							left: 0,
							top: 0,
							// fill: 'white',
							// height: canvas.height,
							// width: canvas.width
							height: 250,
							width: 300, // Changed the size of the state so that it fits better in the canvas. This ties with the scaling X and Y
							selectable: false,
							scaleX: 1.5,
							scaleY: 1.5 // Increasing the size of the state image so it is easier for the user to fit their image into the shape of the state.\
						})

						// canvas.add(overlayState);
						// canvas.setOverlayImage(overlayState);
						// canvas.controlsAboveOverlay = true;

						statePath = String(stateObjects._objects[i].path); // hoping this will work for clip-path... but it doesnt.
						statePathObj = new fabric.Path(statePath);
						statePathObj.set({
							fill: 'red',
							left: 10,
							top: 10,
							width: canvas.width - 10,
							height: canvas.height - 10
						});
						//canvas.add(statePathObj); // This works but is unnecessary since we cant use variables in the clip path


					}
				}
			},
			function(item, object) {
				object.set('id', item.getAttribute('id'));
				groupStates.push(object);
			});


		// // uploading user image
		// var userImage = new fabric.Image();
		// document.getElementById('UploadImage').onchange = function handleImage(e) {
		//
		// 			var reader = new FileReader();
		// 			reader.onload = function(event) {
		//
		// 				var imgObj = new Image();
		// 				imgObj.src = event.target.result;
		// 				imgObj.onload = function() {
		//
		// 					userImage = new fabric.Image(imgObj);
		// 					userImage.set({
		// 						left: 10,
		// 						top: 10,
		// 						width: canvas.width - 10,
		// 						height: canvas.height - 10,
		// 						opacity: 1,
		// 						clipTo: function (ctx) {
		// 							overlayState.set ({
		// 								// left: 10,
		// 								// top: 10,
		// 								// width: canvas.width - 10,
		// 								// height: canvas.height - 10
		// 							});
		// 						 overlayState.render(ctx);
		// 					 }
		// 					});
		// 					canvas.add(userImage);
		// 					userImage.globalCompositeOperation = 'source-atop';
		// 					canvas.renderAll();
		// 				}
		// 			}
		// 			reader.readAsDataURL(e.target.files[0]);
		// 	}


		// uploading user image2
		var userImage = new fabric.Image();
		document.getElementById('UploadImage').onchange = function handleImage(e) {

			var reader = new FileReader();
			reader.onload = function(event) {

				var imgObj = new Image();
				imgObj.src = event.target.result;
				imgObj.onload = function() {

					userImage = new fabric.Image(imgObj);
					userImage.set({
						left: 10,
						top: 10,
						width: canvas.width - 10,
						height: canvas.height - 10,
						opacity: 1,
						clipTo: function(ctx)
						{
							arrowPlane.set({
								left: 0,
								right: 0
							// 	width: ctx.width,
							// 	length: ctx.length,
							// fill: 'red'
						});

						arrowPlane.render(ctx);
						}

						// clipTo: function(ctx) {
						// 	overlayState.set({
						// 		left: -100,
						// 		top: -100,
						// 		width: ctx.width,
						// 		height: ctx.height
						// 	});
						// 	// canvas.centerObject(overlayState);
						// 	overlayState.render(ctx);

						// }
					});
					canvas.add(userImage);
					userImage.globalCompositeOperation = 'source-atop';
					canvas.renderAll();
				}
			}
			reader.readAsDataURL(e.target.files[0]);
		}

		function testPath() {
			document.getElementById("statePath").innerHTML = statePath;
		}
	</script>


</body>

</html>

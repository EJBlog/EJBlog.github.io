<!DOCTYPE html>
<html class="no-js">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Editor</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">

	<link rel="stylesheet" href="css/editor.css">
	<link rel="stylesheet" href="css/ui-lightness-jquery-ui-1.8.7.custom.css">

</head>
<style>

	.clip {
		margin: 1em auto;
		width: 300px; height: 300px;
  		background: #222;
  		clip-path: url(#myClip);
		background-image: url("img/ota_badge.jpg");
	}
	
</style>

<body>
	<div class="clip">
	<svg width="0" height="0">
			<clipPath id="myClip">
		
			<path stroke="#000000" d="M607.2,331.8 l12.6,-0.7 0.1,-4.1 h4.3 l30.4,-3.2 45.1,-4.3 5.6,-3.6 3.9,-2.1 0.1,-1.9 6,-7.8 4.1,-3.6 2.1,-2.4 -3.3,-2 -2.5,-2.7 -3,-3.8 -0.5,-2.2 -2.6,-1.4 -0.9,-1.9 -0.2,-6.1 -2.6,-2 -1.9,-1.1 -0.5,-2.3 -1.3,0.2 -2,1.2 -2.5,2.7 -1.9,-1.7 -2.5,-0.5 -2.4,1.4 h-2.3 l-1.8,-2 -5.6,-0.1 -1.8,-4.5 -2.9,-1.5 -2.1,0.8 -4.2,0.2 -0.5,2.1 1.2,1.5 0.3,2.1 -2.8,2 -3.8,1.8 -2.6,0.4 -0.5,4.5 -4.9,3.6 -2.6,3.7 0.2,2.2 -0.9,2.3 -4.5,-0.1 -1.3,-1.3 -3.9,2.2 0.2,3.3 -2.4,0.6 -0.8,-1.4 -1.7,-1.2 -2.7,1.1 -1.8,3.5 -2.2,-1 -1.4,-1.6 -3.7,0.4 -5.6,1 -2.8,1.3 -1.2,3.4 -1,1 1.5,3.7 -4.2,1.4 -1.9,1.4 -0.4,2.2 1.2,2.4 v2.2 l-1.6,0.4 -6.1,-2.5 -2.3,0.9 -2,1.4 -0.8,1.8 1.7,2.4 -0.9,1.8 -0.1,3.3 -2.4,1.3 -2.1,1.7z" />

			</clipPath>	
			<img clip-path="url(#myClip)" xlink:href="https://www.w3schools.com/images/w3schools_green.jpg">
	</svg>
	</div>
	
	
	
	
	
	
	
	
	<!--<div id="buckwheat-hendrix">
		<svg preserveAspectRatio="xMinYMin meet" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"  viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve">
			<clipPath id="image-mask">
				<path d="M989,787c13.23,110.45-67.83,192.21-165,202c-68.19,6.87-107.31-27.45-138-62c-36.07-7.26-62.19-24.47-86-44c-4.48-27.19-12.12-51.22-23-72c-40.15-5.19-110.15-18.93-78-71c2.8-1.87,5.4-3.93,9-5c-2.55-7.97-5.77-23.12,1-29c-2.81-5.83-7.98-14.23-1-19c-76.28-35.72-159.95-83.21-239-122c-16.39-8.05-29.67-22.13-53-20c-17.23,1.58-28.89,13.98-48,11c-5.04-3.92-16.15-9.92-20-1c19.7,20-28.3,27.92-24,2c7.55-3.79,17.67-5,20-14c-5.35-6.65-14.04-9.96-21-15c-6.98,3.19-12.29,10.51-9,21c-8.96,8.34-25.13,1.58-23-13c9.82-3.18,20.61-5.39,25-14c-3.1-7.9-13.64-8.36-18-15c-10.49,0.09-8.5,22.31-19,23c-4.02,0.26-12.9-5.9-13-10c-0.29-11.78,23.24-5.2,24-19c-4.71-2.96-9.06-6.27-14-9c-6.57,3.77-6.44,14.23-12,19c-9.94-0.3-17.14-1.51-19-7c-4.01-11.83,15.75-11.21,24-17c-2.43-6.23-8.53-8.8-13-13c-5.04,2.96-7.98,8.02-9,15c-6.16,0.69-17.8,3.04-21-2c4.06-9.61,20.73-6.61,23-18c-2.79-5.54-7.12-9.54-13-12c-5.44,0.86-7.51,8.26-5,14c-2,0-4,0-6,0c-0.4,2.4,4.55-0.55,3,3c-9.49,5.09-19.94-7.61-17-18c2.3-4.03,9.73-2.94,16-3c-13.41-13.79-17.21-41.2,2-55c29.2 20.98,62.78,14.62,72,36c9.1,6.62,23.32,1.6,37,3c35.4,3.63,52.57,28.13,75,47c35.44,1.68,66.33,19.38,97,33c83.54,37.09,161.98,78.33,245,114c3.89-4.35,7.47-10.05,5-18c9.13-6.2,18.77-11.89,28-18c-2.36-3.3-8.23-3.11-8-9c40.92-4.75,42.9-48.43,80-57c-0.11-6.11,0.65-11.35,2-16c-28.61-29.39-70.07-45.93-72-102
				c-40.8,3.22-35.49-74.1,6-66c-11.18-24.64-30.93-38.59-34-65c-2.11-18.12,12.6-26.41,10-46c-1.21-9.08-8.54-15.59-7-25
				c0.99-6.02,8.33-10.02,10-16c5.18-18.5,0.39-41.19,10-56c3.62,0.04,2.03,5.31,4,7c17.12-19.55,31.5-41.83,48-62
				c0.6-9.07-1.24-20.57,1-28c19.16-0.5,26.61,10.72,38,18c6.32-3.01,8.56-10.1,15-13c5.83-0.83,3.75,6.25,8,7
				c23.11-10.2,42.74-31.7,56-55c14.5,4.84,15.7,22.97,26,32c2.72,0.72-0.72-4.72,2-4c14.47,4.01,25.48,8.11,43,8
				c3.51-2.49,3.42-8.58,5-13c12.73,6.93,13.89,25.45,28,31c1.68,26.99,25.41,31.92,30,56c-0.31,3.12,2.89-2.54,3,1
				c5.73,14.58-3.42,27.51-2,44c3.84-2.83,3.28-10.06,8-12c8.08,3.07,7.03,21.96,4,30c5,11.81,16.92,8.94,24,19
				c13.13,18.66,0.61,54.12,3,81c-1.23,4.56,3.51,3.16,4,6c-25.93,26.12-59.4,35.21-62,87c-6.84,5.83-14.4,10.93-20,18
				c36.38,4.8,14.71,73.9-19,55c-23.77,41.23-70.58,59.42-116,79c14.98,19.35,39.97,28.7,75,28c5.08-1.25,4-8.67,11-8
				c3.25,16.43-5.99,27.65-12,38c18.94,30.4,47.19,51.47,66,82C920.17,688.29,980.56,716.51,989,787z"/>
			</clipPath>
			<image clip-path="url(#image-mask)" width="1000" height="1000" id="wheatdrix" xlink:href="http://www.toymakerlabs.com/svg_composites/wheatdrix_1000x1000.jpg" />
		</svg>
</div>-->
		
	
	
	
	
	
	
	
	
	
	
	
	<p id="statePath"></p>

	<div id="imageEditor">
		<section id="editorContainer">
			<canvas id="editor" width="480" height="480" style="border:1px solid #000000"></canvas>
		</section>
	</div>

	<input type="file" id="UploadImage" href="#" title="Upload Your Image">Upload Image</input>
	<button type="button" onclick="testPath()">Test Path</button>

	<script src="jquery/jquery-1.12.4.min.js"></script>
	<script src="jquery/jquery-ui-1.10.3.js"></script>
	<script src="js/raphael.js"></script>
	<script src="js/usa_map.js"></script>
	<script src="js/Fabric_JS/fabric.min.js"></script>


	<script>
		//Changing the control colors from light blue to black
		fabric.Object.prototype.set({
			transparentCorners: true,
			borderColor: '#111111',
			cornerColor: '#111111'
		});

		//get information about the state that the user clicked on the main map page
		var stateNameStored = localStorage.getItem('storedStateName');
		var idNameStored = localStorage.getItem('storedIdName');

		// changing the editor background color
		var canvas = new fabric.Canvas('editor', {
			backgroundColor: 'whitesmoke'
		});

		// const flyArrowPath = 'M,361.1,70.77,l,-5.3,57.13,l,-1.3,15.2,l,-59.1,-6.6,l,-49,-7.1,l,-1.4,11.2,l,-1.9,-1.7,l,-0.4,-2.5,l,-1.3,-1.9,l,-3.3,1.5,l,-0.7,2.5,l,-2.3,0.3,l,-3.8,-1.6,l,-4.1,0.1,l,-2.4,0.7,l,-3.2,-1.5,l,-3,0.2,l,-2.1,1.9,l,-0.9,-0.6,l,-0.7,-3.4,l,0.7,-3.2,l,-2.7,-3.2,l,-3.3,-2.5,l,-2.5,-12.6,l,-0.1,-5.3,l,-1.6,-0.8,l,-0.6,1,l,-4.5,3.2,l,-1.2,-0.1,l,-2.3,-2.8,l,-0.2,-2.8,l,7,-17.15,l,-0.6,-2.67,l,-3.5,-1.12,l,-0.4,-0.91,l,-2.7,-3.5,l,-4.6,-10.41,l,-3.2,-1.58,l,-1.8,-4.26,l,1.3,-4.63,l,-3.2,-7.57,l,4.4,-21.29,l,32.7,6.89,l,18.4,3.4,l,32.3,5.3,l,29.3,4,l,29.2,3.5,l,30.8,3.07,z';


	// const arrowPlane = new fabric.Path(flyArrowPath);


		// loading the background/overlay image from SVG of the state that was cicked
		var statePath;
		var statePathObj;
		var groupStates = [];
		var overlayState;
		fabric.loadSVGFromURL("svg/usa_map.svg", function(objects, options) {
				var stateObjects = new fabric.Group(groupStates);
				stateObjects.set({
					left: 10,
					top: 10,
					width: canvas.width - 10,
					height: canvas.height - 10
				});

				for (var i = 0; i < objects.length; i++) {
					if (stateObjects._objects[i].id == idNameStored) {
						overlayState = stateObjects._objects[i];

						overlayState.set({
							// opacity: .4,
							left: 0,
							top: 0,
							stroke: 'black',
							strokeWidth: 2,
							fill: 'transparent',
							// height: canvas.height,
							// width: canvas.width
							height: 250,
							width: 300, // Changed the size of the state so that it fits better in the canvas. This ties with the scaling X and Y
							selectable: false,
							scaleX: 1.5,
							scaleY: 1.5 // Increasing the size of the state image so it is easier for the user to fit their image into the shape of the state.\
						})


						canvas.add(overlayState);
						canvas.setOverlayImage(overlayState);
						canvas.controlsAboveOverlay = true;

						// statePath = String(stateObjects._objects[i].path); // hoping this will work for clip-path... but it doesnt.
						// statePathObj = new fabric.Path(statePath);
						// statePathObj.set({
						// 	fill: 'red',
						// 	left: 10,
						// 	top: 10,
						// 	width: canvas.width - 10,
						// 	height: canvas.height - 10
						// });
						//canvas.add(statePathObj); // This works but is unnecessary since we cant use variables in the clip path


					}
				}
			},
			function(item, object) {
				object.set('id', item.getAttribute('id'));
				groupStates.push(object);
			});


		// // uploading user image
		// var userImage = new fabric.Image();
		// document.getElementById('UploadImage').onchange = function handleImage(e) {
		//
		// 			var reader = new FileReader();
		// 			reader.onload = function(event) {
		//
		// 				var imgObj = new Image();
		// 				imgObj.src = event.target.result;
		// 				imgObj.onload = function() {
		//
		// 					userImage = new fabric.Image(imgObj);
		// 					userImage.set({
		// 						left: 10,
		// 						top: 10,
		// 						width: canvas.width - 10,
		// 						height: canvas.height - 10,
		// 						opacity: 1,
		// 						clipTo: function (ctx) {
		// 							overlayState.set ({
		// 								// left: 10,
		// 								// top: 10,
		// 								// width: canvas.width - 10,
		// 								// height: canvas.height - 10
		// 							});
		// 						 overlayState.render(ctx);
		// 					 }
		// 					});
		// 					canvas.add(userImage);
		// 					userImage.globalCompositeOperation = 'source-atop';
		// 					canvas.renderAll();
		// 				}
		// 			}
		// 			reader.readAsDataURL(e.target.files[0]);
		// 	}


		// uploading user image2
		var userImage = new fabric.Image();
		document.getElementById('UploadImage').onchange = function handleImage(e) {

			var reader = new FileReader();
			reader.onload = function(event) {

				var imgObj = new Image();
				imgObj.src = event.target.result;
				imgObj.onload = function() {

					userImage = new fabric.Image(imgObj);
					userImage.set({
						left: 10,
						top: 10,
						width: canvas.width - 10,
						height: canvas.height - 10,
						opacity: 1
						// ,clipTo: function(ctx)
						// {
						// 	arrowPlane.set({
						// 		left: 50,
						// 		right: 50,
						// 		width: ctx.width,
						// 		length: ctx.length,
						// 	fill: 'red'
						// });
						//
						// arrowPlane.render(ctx);
						// }

						// ,clipTo: function(ctx) {
						// 	overlayState.set({
						// 		left: -100,
						// 		top: -100,
						// 		width: ctx.width,
						// 		height: ctx.height
						// 	});
						// 	// canvas.centerObject(overlayState);
						// 	overlayState.render(ctx);
						// }
					});
					canvas.add(userImage);
					userImage.globalCompositeOperation = 'source-atop';
					canvas.renderAll();
				}
			}
			reader.readAsDataURL(e.target.files[0]);
		}

		function testPath() {
			document.getElementById("statePath").innerHTML = statePath;
		}
	</script>


</body>

</html>
